---
// ============================================================
// src/layouts/BlogPostLayout.astro — Blog Post Page Shell
// ============================================================
//
// WHAT THIS LAYOUT DOES:
// This layout wraps individual blog post pages. It extends
// BaseLayout (so it still has the header, footer, and JS),
// and adds the post-specific header (title, date, tag) and
// the previous/next navigation at the bottom.
//
// HOW BLOG POSTS USE THIS:
// You never use this layout directly. Astro uses it
// automatically from src/pages/blog/[slug].astro, which
// queries the content collection and passes the post data in.
//
// WHAT IS CollectionEntry?
// It's a TypeScript type Astro provides that describes one
// item (entry) from a content collection. Here we use the
// 'blog' collection type so TypeScript knows exactly what
// fields are available (title, date, tag, etc.).
// ============================================================

// Import the shared page shell
import BaseLayout from './BaseLayout.astro';

// Import Astro's TypeScript type for content collection entries
import type { CollectionEntry } from 'astro:content';

// Import the blog collection to look up prev/next post titles
import { getCollection } from 'astro:content';

// ── Props this layout accepts ─────────────────────────────────
// The page at src/pages/blog/[slug].astro passes these in.
interface Props {
  // The full blog post entry from the content collection.
  // Contains: post.data (frontmatter) and post.body (Markdown text)
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

// Destructure frontmatter fields for easy use in the HTML below
const { title, description, date, tag, prevPost, nextPost } = post.data;

// Format the date for display: e.g. "Feb 2026"
// toLocaleDateString converts a Date object to a readable string.
// The options { month: 'short', year: 'numeric' } format it as "Feb 2026".
const displayDate = date.toLocaleDateString('en-GB', { month: 'short', year: 'numeric' });

// ── Look up prev/next post titles for the navigation ─────────
// getCollection('blog') fetches ALL entries from the blog collection.
// We use it to find the title of the previous and next posts so
// we can show "← [Post Title]" rather than just "← Previous Post".
const allPosts = await getCollection('blog');

// Helper: given a slug string, find the matching post entry
const findPost = (slug: string | undefined) =>
  slug ? allPosts.find(p => p.slug === slug) : undefined;

const prevEntry = findPost(prevPost);
const nextEntry = findPost(nextPost);
---

<!--
  Pass the post title and description up to BaseLayout so it
  can put them in the <head> for the browser tab and SEO.
-->
<BaseLayout title={`${title} · Iremi Twins`} description={description}>

  <main class="blog-page">
    <div class="container">

      <!--
        article is the correct HTML semantic element for a
        self-contained piece of content like a blog post.
      -->
      <article class="post-content">

        <!-- ── Post Header ───────────────────────────────────
             The header area above the post body: date, tag,
             title, and lead paragraph.                       -->
        <div class="blog-page__header">
          <div class="post-meta">
            <!-- Date formatted as "Feb 2026" -->
            <span class="blog-card__date">{displayDate}</span>
            <!-- Category tag, e.g. "CSS" or "Web Dev" -->
            <span class="blog-card__tag">{tag}</span>
          </div>
          <!-- Post title — uses section__title class for consistent sizing -->
          <h1 class="section__title">{title}</h1>
          <!-- Lead sentence — same as the description frontmatter field -->
          <p style="color: var(--clr-muted);">{description}</p>
        </div>

        <!-- ── Post Body ─────────────────────────────────────
             <slot /> is where Astro inserts the rendered
             Markdown content of the post. In [slug].astro,
             we render the post's Content component into the
             slot. All the headings, paragraphs, code blocks,
             and lists from the .md file appear here.         -->
        <slot />

        <!-- ── Post Nav ──────────────────────────────────────
             Previous and next post buttons at the bottom.
             Only shown if the frontmatter includes prevPost
             or nextPost slugs.
             The && operator is a conditional render:
               condition && <element />
             renders the element only when condition is true.  -->
        <nav class="post-nav">
          <!-- "← All posts" link — always shown -->
          <a href="/blog" class="btn btn--ghost">← All posts</a>

          {/* Show the previous post button if prevPost is set */}
          {prevEntry && (
            <a href={`/blog/${prevEntry.slug}`} class="btn btn--ghost">
              ← {prevEntry.data.title}
            </a>
          )}

          {/* Show the next post button if nextPost is set */}
          {nextEntry && (
            <a href={`/blog/${nextEntry.slug}`} class="btn btn--ghost">
              {nextEntry.data.title} →
            </a>
          )}
        </nav>

      </article>
    </div>
  </main>

</BaseLayout>
